<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>(3,4,5) Pattern — polished</title>
  <style>
    :root {
      --bg-dark: #000000;
      --bg-light: #ffffff;
      --btn-bg: #F1F3F4;
      --btn-fg: #000000;
    }
    html, body { height: 100%; }
    body {
      margin: 0;
      background: var(--bg-dark);
      color: #ffffff;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      line-height: 1.4;
    }
    body.hide-cursor { cursor: none; }
    body.light { background: var(--bg-light); color: #000; }

    .controls {
      position: fixed;
      top: 12px;
      left: 12px;
      z-index: 1000;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }
    button {
      background-color: var(--btn-bg);
      color: var(--btn-fg);
      border: 2px solid var(--btn-bg);
      padding: 12px 18px;
      font-size: 16px;
      border-radius: 14px;
      cursor: pointer;
      user-select: none;
    }
    button:active { transform: translateY(1px); }

    .stage {
      max-width: 1200px;
      margin: 120px auto 64px; /* leave space for fixed controls */
      padding: 0 16px;
      display: grid;
      justify-items: center;
      gap: 32px;
    }
    .videos { display: grid; gap: 28px; justify-items: center; }
    iframe { max-width: 100%; aspect-ratio: 16/9; }

    audio { width: min(720px, 92vw); }

    .footer {
      position: fixed;
      bottom: 8px;
      left: 8px;
      z-index: 900;
      font-size: 12px;
    }
    .footer span { background: #fff; color: #000; padding: 0 6px; border-radius: 4px; }

    .overlay {
      position: fixed;
      inset: 0;
      z-index: 2000;
      display: grid;
      place-items: center;
      background: #000;
      color: #fff;
      text-align: center;
      padding: 24px;
      font-size: clamp(16px, 3.5vw, 28px);
    }
    .overlay p { max-width: 60ch; opacity: .9; }

    .hidden { display: none !important; }

    /* Hide UI in fullscreen, but keep overlay when in "clear" mode */
    body.fs .controls,
    body.fs audio { display: none !important; }

    /* Clear-screen mode hides everything except overlay */
    body.cleared .controls,
    body.cleared audio,
    body.cleared .stage,
    body.cleared .footer,
    body.cleared img[alt="corner-gif"] { display: none !important; }
  </style>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-QDG3NX05J6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);} gtag('js', new Date());
    gtag('config', 'G-QDG3NX05J6');
  </script>
</head>

<body>
  <!-- Controls -->
  <div class="controls" aria-label="screen controls">
    <button id="btnFullscreen" title="Toggle fullscreen (F)">Full Screen</button>
    <button id="btnClear" title="Clear screen 100% (C / Esc)">Clear Screen: 100% [⌨️ Esc]</button>
  </div>

  <main class="stage" id="content-root">
    <audio id="audio" controls autoplay preload="auto" playsinline></audio>

    <div class="videos" aria-label="looping videos">
      <iframe width="560" height="315" src="https://www.youtube.com/embed/kyql5p7qiUg?version=3&loop=1&playlist=kyql5p7qiUg" title="YouTube video player 1" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

      <iframe width="560" height="315" src="https://www.youtube.com/embed/HZ6L_6a7RcQ?version=3&loop=1&playlist=HZ6L_6a7RcQ" title="YouTube video player 2" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
    </div>
  </main>

  <!-- Clear-screen overlay (shown only in cleared mode) -->
  <div id="overlay" class="overlay hidden" role="dialog" aria-modal="true" aria-live="polite">
    <div>
      <p>Clear Screen mode is active.</p>
      <p>Press <strong>Esc</strong> to restore. Shortcuts: <strong>F</strong> fullscreen, <strong>C</strong> clear, <strong>Space</strong> play/pause audio, <strong>M</strong> mute.</p>
    </div>
  </div>

  <!-- Footer -->
  <div class="footer"><span>&copy; made by humans: https://generated.photos/humans 2023–24</span></div>
  <img src="gif.gif" alt="corner-gif" style="position: fixed; bottom: 0; right: 0; margin: 10px; z-index: 800;" />

  <script>
    // Keep your original anchor/hash behavior
    location.hash = "PYTHAGOREAN_TRIPLE_PATTERN_3__4__5_Dyson_sphere_#feedback@cubicpostcode.com";
  </script>

  <script>
    // --- Cursor auto-hide after inactivity ----------------------------------
    (function cursorAutoHide(){
      let timer;
      const reset = () => { document.body.classList.remove('hide-cursor'); clearTimeout(timer); timer = setTimeout(() => document.body.classList.add('hide-cursor'), 5000); };
      ['mousemove','keydown','pointerdown','touchstart'].forEach(ev => document.addEventListener(ev, reset, { passive: true }));
      reset();
    })();

    // --- Fullscreen helpers ---------------------------------------------------
    const isFullscreen = () => !!document.fullscreenElement;
    const enterFullscreen = () => document.documentElement.requestFullscreen();
    const exitFullscreen  = () => document.exitFullscreen();

    function toggleFullscreen(){
      if (isFullscreen()) { exitFullscreen().catch(()=>{}); }
      else { enterFullscreen().catch(()=>{}); }
    }

    document.addEventListener('fullscreenchange', () => {
      if (isFullscreen()) {
        document.body.classList.add('fs');
      } else {
        document.body.classList.remove('fs');
        // Leaving fullscreen also exits clear mode and restores UI
        document.body.classList.remove('cleared');
        overlay.classList.add('hidden');
      }
    });

    // --- Clear Screen (100%) --------------------------------------------------
    const overlay = document.getElementById('overlay');
    const btnClear = document.getElementById('btnClear');
    btnClear.addEventListener('click', async () => {
      if (!isFullscreen()) { try { await enterFullscreen(); } catch(e){} }
      document.body.classList.add('cleared');
      overlay.classList.remove('hidden');
    });

    // --- Buttons & keyboard shortcuts ----------------------------------------
    const btnFS = document.getElementById('btnFullscreen');
    btnFS.addEventListener('click', toggleFullscreen);

    document.addEventListener('keydown', (e) => {
      if (e.key === 'f' || e.key === 'F') toggleFullscreen();
      else if (e.key === 'c' || e.key === 'C') btnClear.click();
      else if (e.key === 'm' || e.key === 'M') audio.muted = !audio.muted;
      else if (e.key === ' ') { // Space: play/pause
        e.preventDefault();
        if (audio.paused) audio.play().catch(()=>{}); else audio.pause();
      } else if (e.key === 'Escape') {
        // If user presses Esc while not in fullscreen, still restore from clear mode
        if (!isFullscreen() && document.body.classList.contains('cleared')) {
          document.body.classList.remove('cleared');
          overlay.classList.add('hidden');
        }
      }
    });

    // --- Audio: random notes playlist ----------------------------------------
    const audio = document.getElementById('audio');
    const audioFiles = Array.from({length: 12}, (_,i) => `note${40+i}.mp3`); // note40..note51

    function pickRandomFile(){ return audioFiles[Math.floor(Math.random()*audioFiles.length)]; }
    function queueRandom(){ audio.src = pickRandomFile(); }

    function playRandom(){
      queueRandom();
      const p = audio.play();
      if (p && typeof p.catch === 'function') {
        p.catch(() => { /* Likely blocked by autoplay policy; will try again on first user gesture */ });
      }
    }

    audio.addEventListener('ended', () => { queueRandom(); audio.play().catch(()=>{}); });

    // Ensure playback starts after first gesture if autoplay is blocked
    let started = false;
    function ensureStart(){ if (!started) { started = true; playRandom(); } }
    ['click','keydown','touchstart'].forEach(ev => document.addEventListener(ev, ensureStart, { once: true, passive: true }));

    // Try immediately as well (may be blocked)
    playRandom();

    // --- Background toggler (27-second cycle) --------------------------------
    (function backgroundCycle(){
      const ON = new Set([1,3,5,8,10,12,14,17,19,21,23,25]); // preserve your pattern
      function secondsSinceUTCMidnight(){
        const now = new Date();
        const sinceLocalMidnight = now.getTime() - new Date(now).setHours(0,0,0,0);
        let s = Math.floor(sinceLocalMidnight / 1000) + now.getTimezoneOffset() * 60;
        if (s < 0) s += 86400; // wrap
        return s;
      }
      function tick(){
        const mod = secondsSinceUTCMidnight() % 27;
        const light = ON.has(mod);
        document.body.classList.toggle('light', light);
      }
      tick();
      setInterval(tick, 1000);
    })();
  </script>
</body>
</html>
